# Story 1.1: Initialize Repository and Development Environment

Status: done

## Story

As a developer,
I want a working repository with frontend (Next.js 16), backend (NestJS 11), and infrastructure (Docker Compose with KurrentDB 25 + PostgreSQL 18),
so that I have a ready-to-code foundation with all services running locally.

## Acceptance Criteria

1. **Given** a fresh clone of the repository, **When** I run `docker compose up -d` and `npm install` in both `frontend/` and `backend/`, **Then** KurrentDB is accessible on `http://localhost:2113` and PostgreSQL is accessible on port `5432`
2. **Given** Docker services are running, **When** I run `npm run dev` in `frontend/`, **Then** Next.js dev server starts on port `3000` with no errors (Turbopack enabled)
3. **Given** Docker services are running, **When** I run `npm run start:dev` in `backend/`, **Then** NestJS dev server starts on port `3001` with no errors
4. **Given** the backend is initialized, **When** I check Prisma setup, **Then** `prisma/schema.prisma` exists with PostgreSQL datasource configured and an initial empty migration has been created
5. **Given** both apps are initialized, **When** I run `npm run lint` in either app, **Then** ESLint runs with zero errors on the scaffold code, TypeScript strict mode is enabled in both `tsconfig.json` files
6. **Given** code is pushed to a PR on GitHub, **When** the CI workflow triggers, **Then** GitHub Actions runs lint + typecheck for both frontend and backend in parallel

## Tasks / Subtasks

- [x] **Task 1: Create repository structure** (AC: 1, 2, 3)
  - [x] 1.1 Create root directory with `.gitignore` (see Dev Notes for gitignore strategy), `README.md`, `docker-compose.yml`
  - [x] 1.2 Scaffold frontend via `npx create-next-app@latest frontend --typescript --tailwind --eslint --app --src-dir --turbopack`
  - [x] 1.3 Scaffold backend via `npx @nestjs/cli@11 new backend --strict --package-manager npm`
  - [x] 1.4 Verify both apps start independently with no errors

- [x] **Task 2: Configure Docker Compose** (AC: 1)
  - [x] 2.1 Add KurrentDB 25.1.0 service (port 2113, insecure mode, AtomPub enabled)
  - [x] 2.2 Add PostgreSQL 18 service (port 5432, with database `baillr_dev`)
  - [x] 2.3 Add volume persistence for both services
  - [x] 2.4 Verify `docker compose up -d` starts both services, KurrentDB admin UI accessible at `http://localhost:2113`

- [x] **Task 3: Install backend dependencies and configure Prisma 7** (AC: 3, 4)
  - [x] 3.1 Install: `@nestjs/cqrs`, `nestjs-cqrx`, `@kurrent/kurrentdb-client`, `@prisma/client`, `class-validator`, `class-transformer`
  - [x] 3.2 Install: `@prisma/adapter-pg`, `pg` (Prisma 7 requires a driver adapter for PostgreSQL)
  - [x] 3.3 Install dev: `prisma`, `@types/pg`, `dotenv`
  - [x] 3.4 Run `npx prisma init` — creates `prisma/schema.prisma`, `prisma.config.ts`, and `.env`
  - [x] 3.5 `prisma.config.ts` auto-generated by Prisma 7 init (reads DATABASE_URL from env via dotenv)
  - [x] 3.6 Configure `DATABASE_URL` in `.env` to match Docker Compose PostgreSQL
  - [x] 3.7 Add `KURRENTDB_CONNECTION_STRING=kurrentdb://localhost:2113?tls=false` to `.env`
  - [x] 3.8 Run `npx prisma migrate dev --name init` — schema in sync (no models yet, no migration file created)
  - [x] 3.9 Create `.env.example` with all required variables (no secrets)

- [x] **Task 4: Configure frontend environment** (AC: 2)
  - [x] 4.1 Install: `@clerk/nextjs`
  - [x] 4.2 Fix Tailwind CSS 4 configuration if needed (see Dev Notes for v4 specifics)
  - [x] 4.3 Verify/create frontend folder structure: `src/components/`, `src/hooks/`, `src/lib/api/`, `src/lib/utils/`, `src/types/`
  - [x] 4.4 Create `.env.local` with `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` and `NEXT_PUBLIC_BACKEND_URL=http://localhost:3001`
  - [x] 4.5 Create `.env.example` with all required variables (no secrets)

- [x] **Task 5: Configure ESLint + Prettier + TypeScript paths** (AC: 5)
  - [x] 5.1 Configure Prettier in both apps (consistent settings: single quotes, trailing commas, 2-space indent)
  - [x] 5.2 Install `prettier-plugin-tailwindcss` in frontend
  - [x] 5.3 Verify TypeScript `strict: true` in both `tsconfig.json` files
  - [x] 5.4 Configure TypeScript path aliases in backend `tsconfig.json` (see Dev Notes for path mapping)
  - [x] 5.5 Run `npm run lint` in both apps — zero errors

- [x] **Task 6: Set up GitHub Actions CI** (AC: 6)
  - [x] 6.1 Create `.github/workflows/ci.yml`
  - [x] 6.2 Configure trigger on `pull_request` to `main`
  - [x] 6.3 Run frontend lint + typecheck in parallel with backend lint + typecheck
  - [x] 6.4 Run frontend tests + backend tests (Jest, even if no tests yet — setup should pass)

- [x] **Task 7: Create initial backend module structure** (AC: 3)
  - [x] 7.1 Create `src/infrastructure/database/prisma.service.ts` + `database.module.ts`
  - [x] 7.2 Create `src/infrastructure/eventstore/kurrentdb.service.ts` + `eventstore.module.ts` (connection only, no business logic)
  - [x] 7.3 Create `src/shared/types/money.ts` (Money value object — integer cents)
  - [x] 7.4 Create `src/shared/exceptions/domain.exception.ts` (base DomainException class)
  - [x] 7.5 Create `src/infrastructure/filters/domain-exception.filter.ts` (global ExceptionFilter — see Dev Notes for implementation)
  - [x] 7.6 Create `src/domain/ports/` directory with a `README.md` placeholder documenting the port pattern
  - [x] 7.7 Wire modules into `app.module.ts` with CqrxModule.forRoot
  - [x] 7.8 Configure global `/api` prefix and DomainException filter in `main.ts` (see Dev Notes)
  - [x] 7.9 Verify NestJS starts and connects to both KurrentDB and PostgreSQL

## Dev Notes

### CRITICAL: This is the Foundation Story

Every subsequent story (50 stories across 9 epics) builds on this foundation. Decisions made here propagate through the entire codebase. Follow the architecture document exactly.

### Architecture Pattern: Hexagonal CQRS/ES

The backend follows a strict hexagonal CQRS/Event Sourcing pattern:
- **`domain/`** = Write side. Depends ONLY on its own interfaces (ports). NEVER imports Prisma, PostgreSQL, or KurrentDB client directly.
- **`presentation/`** = Read side. Uses Prisma for PostgreSQL queries. NEVER writes events.
- **`infrastructure/`** = Adapters for both sides. Connects to KurrentDB, PostgreSQL, Clerk, etc.
- **`shared/`** = Value objects and exceptions used across layers.

**FORBIDDEN PATTERNS:**
- No business logic in command handlers — all logic lives in aggregates
- No direct database access in domain layer
- No `console.log` — use NestJS `Logger` always
- No floating-point for money — integer cents only (`money.ts`)

### File Naming Conventions (MANDATORY)

**Backend files:** `kebab-case` with mandatory suffixes:
- `.command.ts`, `.query.ts`, `.event.ts`, `.handler.ts`, `.projection.ts`
- `.controller.ts`, `.module.ts`, `.guard.ts`, `.service.ts`, `.aggregate.ts`, `.port.ts`

**Frontend files:** `kebab-case.tsx` for components, `use-*.ts` for hooks, `*-api.ts` for API clients

**Classes:** `PascalCase` — `CreateATenantCommand`, `TenantCreated`
**Variables:** `camelCase` — `entityId`, `monthlyRentCents`

### Tailwind CSS 4 — BREAKING CHANGES from v3

Tailwind CSS 4 has significant configuration changes. The `create-next-app@latest` (Next.js 16) scaffolder should generate v4-style config, but verify and fix if needed:

**v4 CSS import** (NOT the old `@tailwind` directives):
```css
@import "tailwindcss";
```

**v4 PostCSS config** (`postcss.config.mjs`):
```js
export default {
  plugins: {
    '@tailwindcss/postcss': {},
  },
};
```

**v4 Theme configuration** — uses `@theme` directive in CSS, NOT `tailwind.config.js`:
```css
@import "tailwindcss";
@theme {
  --color-primary: oklch(0.45 0.12 200); /* Deep teal */
}
```

**Install:** `npm install tailwindcss@4 @tailwindcss/postcss`

If `create-next-app` generates a `tailwind.config.js`, it may need to be migrated to CSS-based config. Check the scaffold output carefully.

### Next.js 16 — KEY DIFFERENCES from v15

Next.js 16 enforces changes that were optional/deprecated in v15:

**Async APIs are now mandatory** — `params`, `searchParams`, `cookies()`, `headers()` must be `await`ed:
```typescript
// Next.js 16 — params must be awaited
export default async function Page({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  // ...
}
```

**Other changes:**
- Node.js 20.9+ required (was 18.17+ in v15)
- Turbopack is the default bundler (`--turbopack` flag still works but is now default)
- `next/image` improvements (automatic `srcSet` optimization)

For this story (Story 1.1), these changes only affect the default `app/page.tsx` scaffold. No routes with dynamic params are created yet.

### Docker Compose Configuration

```yaml
services:
  kurrentdb:
    image: kurrentplatform/kurrentdb:25.1.0
    container_name: kurrentdb
    ports:
      - "2113:2113"
    environment:
      - KURRENTDB_INSECURE=true
      - KURRENTDB_ENABLE_ATOM_PUB_OVER_HTTP=true
      - KURRENTDB_RUN_PROJECTIONS=All
    volumes:
      - kurrentdb-data:/var/lib/kurrentdb
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:2113/health/live"]
      interval: 10s
      timeout: 5s
      retries: 5

  postgres:
    image: postgres:18-alpine
    container_name: baillr-postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=baillr
      - POSTGRES_PASSWORD=baillr_dev
      - POSTGRES_DB=baillr_dev
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U baillr -d baillr_dev"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  kurrentdb-data:
  postgres-data:
```

### Environment Variables

**Backend `.env`:**
```
DATABASE_URL=postgresql://baillr:baillr_dev@localhost:5432/baillr_dev
KURRENTDB_CONNECTION_STRING=kurrentdb://localhost:2113?tls=false
CLERK_SECRET_KEY=sk_test_PLACEHOLDER
PORT=3001
```

**Frontend `.env.local`:**
```
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_PLACEHOLDER
NEXT_PUBLIC_BACKEND_URL=http://localhost:3001
```

### NestJS CqrxModule Configuration

```typescript
// app.module.ts
import { Module } from '@nestjs/common';
import { CqrxModule } from 'nestjs-cqrx';
import { DatabaseModule } from './infrastructure/database/database.module';

@Module({
  imports: [
    CqrxModule.forRoot({
      eventstoreConnectionString: process.env.KURRENTDB_CONNECTION_STRING,
    }),
    DatabaseModule,
  ],
})
export class AppModule {}
```

### Prisma 7 Configuration — BREAKING CHANGES from v6

Prisma 7 is **ESM-only** and requires a **driver adapter** for PostgreSQL. The old `@prisma/client` auto-connection is gone — you must explicitly provide a driver adapter.

**1. `prisma.config.ts`** (new file at backend root):
```typescript
// prisma.config.ts
import path from 'node:path';
import { defineConfig } from 'prisma/config';

export default defineConfig({
  earlyAccess: true,
  schema: path.join('prisma', 'schema.prisma'),
});
```

**2. `prisma/schema.prisma`**:
```prisma
// prisma/schema.prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Read models will be added by subsequent stories.
// This file is intentionally minimal for Story 1.1.
```

**3. PrismaService initialization with driver adapter**:
```typescript
// src/infrastructure/database/prisma.service.ts
import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';
import pg from 'pg';

const pool = new pg.Pool({ connectionString: process.env.DATABASE_URL });
const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });
```

**Key differences from Prisma 6:**
- `@prisma/adapter-pg` + `pg` packages are **required** (not optional)
- `previewFeatures = ["driverAdapters"]` must be in schema
- PrismaClient constructor takes `{ adapter }` instead of auto-connecting
- `prisma.config.ts` replaces some CLI flags

**ESM/CJS compatibility with NestJS:** The `prisma` CLI is ESM-only, but `@prisma/client` 7.x ships **dual ESM+CJS** exports. NestJS 11 uses CommonJS by default — this works fine. Do NOT add `"type": "module"` to backend `package.json`. The CLI runs standalone (npx prisma ...) so ESM-only CLI is not a problem.

### GitHub Actions CI

```yaml
# .github/workflows/ci.yml
name: CI
on:
  pull_request:
    branches: [main]

jobs:
  frontend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: frontend
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      - run: npm ci
      - run: npm run lint
      - run: npx tsc --noEmit

  backend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: backend
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json
      - run: npm ci
      - run: npm run lint
      - run: npx tsc --noEmit
      - run: npm test
```

### Money Value Object

```typescript
// src/shared/types/money.ts
export class Money {
  constructor(public readonly cents: number) {
    if (!Number.isInteger(cents)) {
      throw new Error('Money must be expressed in integer cents');
    }
  }

  static fromEuros(euros: number): Money {
    return new Money(Math.round(euros * 100));
  }

  toEuros(): number {
    return this.cents / 100;
  }

  add(other: Money): Money {
    return new Money(this.cents + other.cents);
  }

  subtract(other: Money): Money {
    return new Money(this.cents - other.cents);
  }
}
```

### DomainException Base Class

```typescript
// src/shared/exceptions/domain.exception.ts
export class DomainException extends Error {
  constructor(
    message: string,
    public readonly code: string,
    public readonly statusCode: number = 400,
  ) {
    super(message);
    this.name = 'DomainException';
  }
}
```

### DomainException Filter Implementation

```typescript
// src/infrastructure/filters/domain-exception.filter.ts
import { ExceptionFilter, Catch, ArgumentsHost, Logger } from '@nestjs/common';
import { Response } from 'express';
import { DomainException } from '../../shared/exceptions/domain.exception';

@Catch(DomainException)
export class DomainExceptionFilter implements ExceptionFilter {
  private readonly logger = new Logger(DomainExceptionFilter.name);

  catch(exception: DomainException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();

    this.logger.warn(`Domain exception: ${exception.code} — ${exception.message}`);

    response.status(exception.statusCode).json({
      statusCode: exception.statusCode,
      code: exception.code,
      message: exception.message,
    });
  }
}
```

### NestJS main.ts Configuration

```typescript
// src/main.ts
import { NestFactory } from '@nestjs/core';
import { Logger, ValidationPipe } from '@nestjs/common';
import { AppModule } from './app.module';
import { DomainExceptionFilter } from './infrastructure/filters/domain-exception.filter';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  const logger = new Logger('Bootstrap');

  app.setGlobalPrefix('api');
  app.useGlobalFilters(new DomainExceptionFilter());
  app.useGlobalPipes(new ValidationPipe({ transform: true, whitelist: true }));

  const port = process.env.PORT ?? 3001;
  await app.listen(port);
  logger.log(`Application running on port ${port}`);
}
bootstrap();
```

### TypeScript Path Aliases (Backend)

Configure path aliases in `tsconfig.json` so imports match the hexagonal architecture:
```json
{
  "compilerOptions": {
    "paths": {
      "@shared/*": ["src/shared/*"],
      "@infrastructure/*": ["src/infrastructure/*"],
      "@domain/*": ["src/domain/*"]
    }
  }
}
```

Note: NestJS CLI uses `tsc` which respects `paths`, but you may need `tsconfig-paths` (already included in NestJS scaffold) to resolve paths at runtime.

### Git Ignore Strategy

**Root `.gitignore` must include:**
```
# Dependencies
node_modules/

# Environment files (secrets)
.env
.env.local
.env.*.local

# Do NOT gitignore these:
# .env.example — committed (no secrets, only placeholders)
# prisma/migrations/ — committed (tracks schema evolution)

# Build outputs
dist/
.next/
.turbo/

# IDE
.vscode/
.idea/
*.swp

# OS
.DS_Store
Thumbs.db
```

### Exact Library Versions to Install

**Frontend (`frontend/package.json`):**
| Package | Version | Purpose |
|---------|---------|---------|
| next | 16.x | App Router framework |
| react | 19.x | UI library |
| tailwindcss | 4.x | CSS framework |
| @tailwindcss/postcss | 4.x | PostCSS plugin |
| @clerk/nextjs | 6.x | Authentication |

**Backend (`backend/package.json`):**
| Package | Version | Purpose |
|---------|---------|---------|
| @nestjs/core | 11.x | Framework |
| @nestjs/cqrs | 11.x | CQRS pattern |
| nestjs-cqrx | 5.x | KurrentDB integration |
| @kurrent/kurrentdb-client | latest | KurrentDB driver (peer dep of nestjs-cqrx) |
| @prisma/client | 7.x | ORM for read models |
| @prisma/adapter-pg | 7.x | PostgreSQL driver adapter (required by Prisma 7) |
| pg | latest | PostgreSQL client driver |
| prisma (dev) | 7.x | Schema management |
| @types/pg (dev) | latest | TypeScript types for pg |
| class-validator | latest | DTO validation |
| class-transformer | latest | DTO transformation |

### What NOT To Create in This Story

This story creates the **skeleton only**. Do NOT create:
- Any route pages beyond the default `app/page.tsx`
- Any domain modules (entity, tenant, lease, etc.) — those come in Epics 2-9
- Any Prisma models — the schema stays empty
- Clerk middleware or auth guards — that's Story 1.2
- Layout components (sidebar, header) — that's Story 1.3
- shadcn/ui components — that's Story 1.3
- Any API endpoints — those come later

### Project Structure Notes

- **Two independent apps** in one repo — NO monorepo tooling (no Turborepo, no Nx, no workspace)
- Each app has its own `package.json`, `node_modules`, `tsconfig.json`
- The ONLY integration point between frontend and backend is HTTP/REST
- No shared TypeScript types between apps

### References

- [Source: architecture.md#Repository Structure] — Complete folder tree and conventions
- [Source: architecture.md#Technical Stack] — All versions and rationale
- [Source: architecture.md#Backend Architecture] — CQRS/ES pattern, hexagonal architecture
- [Source: architecture.md#Frontend Architecture] — Next.js App Router, TanStack Query, Clerk
- [Source: architecture.md#Local Development] — Docker Compose, ports, dev servers
- [Source: architecture.md#CI/CD] — GitHub Actions configuration
- [Source: epics.md#Story 1.1] — Acceptance criteria and user story
- [Source: epics.md#Additional Requirements from Architecture] — Starter template spec

## Dev Agent Record

### Agent Model Used

Claude Opus 4.6 (claude-opus-4-6)

### Debug Log References

- Prisma 7 `prisma-client` provider requires explicit `output` path — generated client is ESM-only TypeScript. Switched to `prisma-client-js` provider which generates CJS-compatible client to `node_modules/@prisma/client`.
- `nestjs-cqrx` package exports map lacks `types` condition — created `src/types/nestjs-cqrx.d.ts` ambient declaration for `moduleResolution: "nodenext"` compatibility.
- `driverAdapters` preview feature deprecated in Prisma 7.3.0 — removed from schema (now stable).
- NestJS requires `import 'dotenv/config'` at top of `main.ts` to load `.env` before module initialization.
- Node.js 22.22.0 required (Prisma 7 needs 20.19+ or 22.12+).
- `nestjs-cqrx` is ESM-only (.mjs) — Node.js 22 supports `require()` of ESM modules, making it compatible with NestJS CJS compilation.

### Completion Notes List

- ✅ Task 1: Repository structure created — Next.js 16.1.6 frontend, NestJS 11.0.16 backend, root configs
- ✅ Task 2: Docker Compose with KurrentDB 25.1.0 + PostgreSQL 18 — both services healthy with healthchecks
- ✅ Task 3: Backend deps installed, Prisma 7.3.0 configured with `prisma-client-js` provider and `@prisma/adapter-pg` driver adapter
- ✅ Task 4: Frontend configured — @clerk/nextjs installed, Tailwind CSS 4 verified, folder structure created, env files
- ✅ Task 5: ESLint + Prettier configured for both apps, TypeScript strict mode enabled, path aliases added to backend
- ✅ Task 6: GitHub Actions CI workflow created — parallel frontend + backend lint/typecheck/test
- ✅ Task 7: Hexagonal CQRS/ES backend structure — PrismaService with driver adapter, KurrentDB service, CqrxModule, Money value object, DomainException + filter, domain ports directory
- ✅ Tests: 18 tests passing (4 suites) — Money (10), DomainException (3), DomainExceptionFilter (2), AppController (1) + existing scaffold tests
- ✅ NestJS connects to both PostgreSQL (via Prisma) and KurrentDB (via CqrxModule) on startup

### Change Log

| Task | Files Modified | Status |
|------|---------------|--------|
| Task 1 | .gitignore, README.md, docker-compose.yml, frontend/* (scaffold), backend/* (scaffold), frontend/tsconfig.json | ✅ Complete |
| Task 2 | docker-compose.yml | ✅ Complete |
| Task 3 | backend/package.json, backend/prisma/schema.prisma, backend/prisma.config.ts, backend/.env, backend/.env.example | ✅ Complete |
| Task 4 | frontend/package.json, frontend/.env.local, frontend/.env.example, frontend/src/{components,hooks,lib,types}/ | ✅ Complete |
| Task 5 | backend/.prettierrc, frontend/.prettierrc, backend/tsconfig.json, backend/src/main.ts | ✅ Complete |
| Task 6 | .github/workflows/ci.yml | ✅ Complete |
| Task 7 | backend/src/infrastructure/**, backend/src/shared/**, backend/src/domain/**, backend/src/app.module.ts, backend/src/main.ts, backend/src/types/nestjs-cqrx.d.ts | ✅ Complete |

### File List

**Root:**
- `.gitignore` (created)
- `README.md` (created)
- `docker-compose.yml` (created)
- `.github/workflows/ci.yml` (created)

**Frontend:**
- `frontend/` (scaffolded by create-next-app@latest — Next.js 16.1.6)
- `frontend/tsconfig.json` (modified — scoped include to `src/**`)
- `frontend/.prettierrc` (created)
- `frontend/.env.local` (created)
- `frontend/.env.example` (created)
- `frontend/src/components/` (created)
- `frontend/src/hooks/` (created)
- `frontend/src/lib/api/` (created)
- `frontend/src/lib/utils/` (created)
- `frontend/src/types/` (created)

**Backend:**
- `backend/` (scaffolded by @nestjs/cli — NestJS 11.0.16)
- `backend/.prettierrc` (modified — added tabWidth, semi, printWidth)
- `backend/.env` (created)
- `backend/.env.example` (created)
- `backend/tsconfig.json` (modified — strict: true, paths)
- `backend/prisma/schema.prisma` (modified — prisma-client-js, removed driverAdapters preview)
- `backend/prisma.config.ts` (auto-generated by Prisma 7)
- `backend/src/main.ts` (modified — dotenv, global prefix, filters, pipes)
- `backend/src/app.module.ts` (modified — CqrxModule, DatabaseModule, EventStoreModule)
- `backend/src/types/nestjs-cqrx.d.ts` (created — ambient type declaration)
- `backend/src/infrastructure/database/prisma.service.ts` (created)
- `backend/src/infrastructure/database/database.module.ts` (created)
- `backend/src/infrastructure/eventstore/kurrentdb.service.ts` (created)
- `backend/src/infrastructure/eventstore/eventstore.module.ts` (created)
- `backend/src/infrastructure/filters/domain-exception.filter.ts` (created)
- `backend/src/infrastructure/filters/domain-exception.filter.spec.ts` (created)
- `backend/src/shared/types/money.ts` (created)
- `backend/src/shared/types/money.spec.ts` (created)
- `backend/src/shared/exceptions/domain.exception.ts` (created)
- `backend/src/shared/exceptions/domain.exception.spec.ts` (created)
- `backend/src/domain/ports/README.md` (created)

## Senior Developer Review (AI)

**Reviewer:** Monsieur on 2026-02-08
**Agent Model:** Claude Opus 4.6 (claude-opus-4-6)
**Outcome:** Approved with fixes applied

### Issues Found: 3 High, 4 Medium, 2 Low

#### HIGH Issues (Fixed)

1. **H1 — Prisma schema missing `url` in datasource** `backend/prisma/schema.prisma`
   - datasource block had no `url = env("DATABASE_URL")`, contradicting story spec
   - **Fix:** Added `url = env("DATABASE_URL")` to datasource block

2. **H2 — Architecture doc versions outdated** `_bmad-output/planning-artifacts/architecture.md`
   - Version table listed Next.js 15.x, Prisma 6.x, PostgreSQL 16+ — actual: 16.x, 7.x, 18
   - **Fix:** Updated version table to match implementation reality

3. **H3 — CI workflow missing frontend tests** `.github/workflows/ci.yml`
   - Frontend job had no `npm test` step; frontend `package.json` had no `test` script
   - **Fix:** Added `npm test` step to CI frontend job; added `test` script to frontend package.json

#### MEDIUM Issues (Fixed)

4. **M1 — Empty frontend directories not git-trackable** `frontend/src/{components,hooks,lib,types}/`
   - Empty directories would be lost on clone
   - **Fix:** Added `.gitkeep` files to all 5 empty directories

5. **M2 — Personal PDFs at project root, no .gitignore pattern** `.gitignore`
   - 3 personal financial PDFs in root; no `*.pdf` in .gitignore
   - **Fix:** Added `*.pdf` pattern to .gitignore

6. **M3 — Scaffold metadata in layout.tsx** `frontend/src/app/layout.tsx`
   - Still said "Create Next App" instead of Baillr
   - **Fix:** Updated title to "Baillr" and description to project description

7. **M4 — ESLint disables no-explicit-any** `backend/eslint.config.mjs`
   - `@typescript-eslint/no-explicit-any` set to `'off'`, contradicting strict TypeScript
   - **Fix:** Changed to `'warn'`

#### LOW Issues (Not fixed — cosmetic)

8. **L1 — Story Dev Notes spec shows deprecated `previewFeatures`** — Doc inconsistency only, implementation correct
9. **L2 — No Prisma migration created** — Expected: AC4 says "initial empty migration" but Prisma skips migration when schema has no models. Acceptable behavior.

### Post-Review Validation

- Backend lint: ✅ Pass
- Backend tests: ✅ 18/18 passing (4 suites)
- Frontend lint: ✅ Pass
- Frontend typecheck: ✅ Pass

### Review Change Log

| Fix | Files Modified | Status |
|-----|---------------|--------|
| H1 | backend/prisma/schema.prisma | ✅ Fixed |
| H2 | _bmad-output/planning-artifacts/architecture.md | ✅ Fixed |
| H3 | .github/workflows/ci.yml, frontend/package.json | ✅ Fixed |
| M1 | frontend/src/{components,hooks,lib/api,lib/utils,types}/.gitkeep | ✅ Fixed |
| M2 | .gitignore | ✅ Fixed |
| M3 | frontend/src/app/layout.tsx | ✅ Fixed |
| M4 | backend/eslint.config.mjs | ✅ Fixed |
