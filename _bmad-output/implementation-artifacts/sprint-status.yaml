# generated: 2026-02-08
# project: Baillr
# project_key: NOKEY
# tracking_system: file-system
# story_location: _bmad-output/implementation-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Implementation complete, ready for review
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - done: Retrospective has been completed
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically creates next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)

generated: 2026-02-08
project: Baillr
project_key: NOKEY
tracking_system: file-system
story_location: _bmad-output/implementation-artifacts

development_status:
  # Epic 1: Project Foundation & Authentication (4 stories)
  epic-1: done
  1-1-initialize-repository-and-development-environment: done
  1-2-configure-clerk-authentication-with-jwt-verification: done
  1-3-implement-core-layout-shell-with-responsive-design: done
  1-4-create-empty-dashboard-with-action-feed-placeholder: done
  epic-1-retrospective: optional

  # Epic 2: Portfolio Setup — Entities, Properties & Units (6 stories)
  epic-2: done
  2-1-create-and-manage-ownership-entities: done
  2-2-associate-bank-accounts-to-an-entity: done
  2-3-implement-entity-switcher-component: done
  2-4-create-properties-under-an-entity: done
  2-5-create-and-configure-units-within-a-property: done
  2-6-display-unit-mosaic-on-dashboard: done
  epic-2-retrospective: done

  # Consolidation Sprint — Testing & Anti-Patterns (3 stories, blocking Epic 3)
  consolidation: done
  c-1-setup-vitest-and-retrotest-epic2-frontend: done
  c-2-setup-playwright-e2e-onboarding-scenarios: done
  c-3-centralize-antipatterns-and-dto-checklist: done
  consolidation-retrospective: done

  # Epic 3: Tenant & Lease Management (6 stories)
  epic-3: done
  3-1-register-tenants-with-contact-information: done
  3-2-track-tenant-insurance-with-expiry-alerts: done
  3-3-create-a-lease-linking-tenant-to-unit: done
  3-4-configure-billing-lines-per-lease: done
  3-5-configure-lease-revision-parameters: done
  3-6-terminate-a-lease-with-pro-rata-calculation: done
  epic-3-retrospective: done

  # Epic 4: Rent Call Generation & Email Sending (3 stories)
  epic-4: done
  4-1-generate-rent-calls-for-all-active-leases-in-batch: done # reviewed 2026-02-13, 20 findings + 2 arch fixes
  4-2-generate-rent-call-pdf-documents: done # reviewed 2026-02-13, 12 findings + CORS fix
  4-3-send-rent-calls-by-email-in-batch-with-pdf-attachments: done # reviewed 2026-02-13, 14 findings, 10 fixes — CQRS boundary (domain interfaces), RFC 5322 quoting, dead tenantName field, React key, E2E anti-pattern, contentType generic, DTO @IsNotEmpty, assembler Prisma decoupling, format-tenant-name tests, totalFormatted escape
  epic-4-retrospective: optional

  # Epic 5: Bank Reconciliation & Payment Management (6 stories)
  epic-5: done
  5-1-import-bank-statements-from-csv-excel: done
  5-2-auto-match-payments-to-rent-calls: done
  5-3-validate-reject-or-manually-assign-payment-matches: done # reviewed 2026-02-14, 12+15 findings, 10+14 fixes — pass 1: bankStatementId traceability, DTO validation, E2E URL, responsive stepper, dark mode, fragile selector, hook tests; pass 2 (adversarial): CRITICAL cross-entity auth bypass, bankStatementId null semantics, non-deterministic aggregate, event validation, double-click guard, availableRentCalls server-side, DTO dedup, line-through badge, E2E conditional assertion
  5-4-record-manual-payments-cash-check: done # reviewed 2026-02-14, 9 findings, 9 fixes — @IsString/@Max DTO H1+H2, || vs ?? M1, dialog useEffect sync M2, double-click guard M3, neutral default icon M5, already-paid test L1, E2E value type L2, File List gap L3
  5-5-handle-partial-payments-overpayments-and-tenant-current-account: done # reviewed 2026-02-14, 9 findings (3H/4M/2L), 9 fixes — @@unique idempotency (Payment+AccountEntry), cache invalidation tenant account, event validation parity, unused userId removal, scalar fields partial-payment guard, File List sync, paidAt guard, overpayment comment
  5-6-generate-receipts-quittances-and-partial-payment-receipts: done # reviewed 2026-02-14, 12 findings (2H/5M/5L), 10 fixes — phantom File List entry, AC 9 title alignment, DRY download helper, sanitizeForFilename spaces, billingLines type widening, fixture email field, explicit mock, pdf-constants extraction, unused HttpCode import
  epic-5-retrospective: done

  # Epic 6: Unpaid Rent Management & Reminders (5 stories)
  epic-6: done
  6-1-detect-late-payments-and-display-unpaid-status: done # reviewed 2026-02-14, 10 findings (2H/5M/3L), 7 fixes — DTO @IsNotEmpty/@Type, unpaid cache invalidation, E2E assertion robustness, E2E selector alignment, UnitMosaic sent color regression, timezone normalization
  6-2-propose-3-tier-escalation-actions: done # reviewed 2026-02-14, 10 findings (3H/5M/2L), 12 fixes — dead code exceptions removed (H1), N+1 batch endpoint (H2), success icon (H3), unused imports/constants (M1/M2), @IsString DTO (M3), File List sync (M4/M5), table name (L2), type errors (bonus), re-stage (L1)
  6-3-send-email-reminders-tier-1: done # absorbed by 6.2 — Tier 1 email reminder fully implemented (controller, handler, template, frontend hook, E2E)
  6-4-generate-formal-notices-mise-en-demeure-tier-2: done # absorbed by 6.2 — Tier 2 formal notice PDF fully implemented (controller, handler, template, assembler, frontend hook, E2E)
  6-5-generate-stakeholder-notification-letters-tier-3: done # absorbed by 6.2 — Tier 3 stakeholder letters fully implemented (controller, handler, template, assembler, frontend hook)
  epic-6-retrospective: optional

  # Epic 7: Index Revision & Annual Charges (8 stories)
  epic-7: in-progress
  7-1-enter-and-validate-insee-indices-irl-ilc-icc: done # reviewed 2026-02-14, 12 findings (3H/4M/3L), 10 fixes — @IsNotEmpty DTO H1, dead DuplicateIndexException removed H2, form.reset timing H3, GET type validation M1, finder userId consistency M2, E2E AC#6 duplicate test M3, IndexValue float decimal fix M4, duplicate error display L1, file list count L2, empty module removed L3
  7-2-calculate-revised-rent-using-official-formula: done # reviewed 2026-02-14, 10 findings (3H/4M/3L), 9 fixes — cross-entity data leak (entityId on findByTypeQuarterYear), dead code exceptions removed, double-click guard, error display, useRevisions tests, test rename, E2E selector
  7-3-review-and-batch-approve-pending-revisions: done # reviewed 2026-02-14, 12 findings (2H/6M/4L), 10 fixes + Saga/Reaction arch refactor — cross-BC decoupled via RevisionApprovedReaction (KurrentDB subscription → CommandBus dispatch → ReviseLeaseRentHandler in Tenancy BC), zero cross-BC aggregate imports
  7-4-generate-irl-ilc-icc-revision-letters: done # reviewed 2026-02-14, 10 fixes — baseIndexYear missing from CQRS chain (H1, 12 files), useRef download guard (M2+M5), template test coverage (M4), UTC date formatting (L2), @HttpCode removal (L1), E2E simplification (L3)
  7-5-enter-actual-annual-charges-by-category: done # reviewed 2026-02-14, 12 findings (1C/3H/4M/4L), 6 fixes — repository.load() for rehydration (C1), label tooLong() factory (H1), DTO @MaxLength id (H2), InvalidChargeAmountException rename (M3), File List count fix (M1), no-op guard handler test
  7-5b-add-charge-category-to-billing-lines: done # reviewed 2026-02-14, 10 findings (1H/5M/4L), 7 fixes — duplicate BillingLineCategory→ChargeCategory cross-BC import (H1), Zod enum validation (M2), File List sync (M1), type safety casts
  7-5c-normalize-billing-lines-with-charge-category-table: done # reviewed 2026-02-15, 10 findings (1H/5M/4L), 11 fixes — H1: 5 test fixtures stale format, M1: unscoped findByIds removed, M4: debug.png cleaned, M5: onDelete Restrict FK, L1: File List count 10→12, L2: use-charge-categories hook tests (4 tests), L3: seeder sequential→createMany batch, L4: E2E api fixture methods
  7-6-enter-individual-water-meter-readings-per-unit: done # reviewed 2026-02-15, 10 findings (3H/4M/3L), 8 fixes — type mismatch H1, null-guard chargeCategoryId H2, DTO deviation doc H3, role="status" M2, File List count M4, consumption null-guards in 2 components + 2 tests
  7-7-calculate-and-generate-charge-regularization-statements: ready-for-dev
  7-8-apply-regularization-credits-debits-to-tenant-accounts: backlog
  epic-7-retrospective: optional

  # Epic 8: Dashboard, Accounting & Monitoring (8 stories)
  epic-8: backlog
  8-1-implement-event-sourced-account-book-livre-de-comptes: backlog
  8-2-view-and-filter-the-account-book: backlog
  8-3-export-account-book-as-excel-for-2072-tax-declaration: backlog
  8-4-display-dashboard-with-unit-payment-status-mosaic: backlog
  8-5-display-kpis-and-collection-rate: backlog
  8-6-display-action-feed-with-pending-tasks: backlog
  8-7-display-treasury-chart-income-vs-expenses-over-time: backlog
  8-8-send-email-alerts-for-critical-events: backlog
  epic-8-retrospective: optional

  # Consolidation Sprint 2 — CQRS Query-Side Normalization (blocking Epic 8)
  consolidation-2: in-progress
  c2-1-normalize-cqrs-query-side-across-all-presentation-modules: done # reviewed 2026-02-15, 10 findings (2H/5M/3L), 10 fixes — syntax error INSEE controller, PrismaService→Finder in provisions handler, duplicate interfaces extracted, unsafe cast typed, return type annotations, File List accuracy

  # Epic 9: Integrations & Advanced Features (4 stories)
  epic-9: backlog
  9-1-connect-to-bank-via-open-banking-api: backlog
  9-2-send-registered-mail-via-ar24-maileva-integration: backlog
  9-3-automatic-insee-index-retrieval: backlog
  9-4-grant-accountant-read-only-access: backlog
  epic-9-retrospective: optional
